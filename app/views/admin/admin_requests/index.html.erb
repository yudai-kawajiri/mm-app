<%= content_for(:title, t('admin.admin_requests.index.title')) %>

<div data-controller="resource-search">
  <%= render 'shared/layouts/header_with_actions',
      title: t('admin.admin_requests.index.title'),
      resource: nil,
      is_index_page: true,
      is_form_page: false,
      is_show_page: false,
      new_path: nil,
      skip_store_check: true %>

  <%= render 'shared/forms/search_form',
      form_path: scoped_path(:admin_admin_requests_path),
      search_placeholder: t('admin.admin_requests.index.search.placeholder'),
      sort_options: [
        [t('admin.admin_requests.index.sort_options.company'), 'company'],
        [t('admin.admin_requests.index.sort_options.store'), 'store'],
        [t('admin.admin_requests.index.sort_options.created_at'), 'created_at']
      ],
      sort_by: params[:sort_by],
      category_options: nil,
      hide_category: true %>

  <% if @admin_requests.any? %>
    <div class="table-responsive" data-resource-search-target="results">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <% if current_user.super_admin? %>
              <th><%= t('admin.admin_requests.index.table_headers.company') %></th>
            <% end %>
            <th><%= t('admin.admin_requests.index.table_headers.user') %></th>
            <th><%= t('admin.admin_requests.index.table_headers.store') %></th>
            <th><%= t('admin.admin_requests.index.table_headers.request_type') %></th>
            <th><%= t('admin.admin_requests.index.table_headers.status') %></th>
            <th><%= t('admin.admin_requests.index.table_headers.created_at') %></th>
            <th class="text-center"><%= t('admin.admin_requests.index.table_headers.actions') %></th>
          </tr>
        </thead>
        <tbody>
          <% @admin_requests.each do |request| %>
            <tr data-resource-search-target="row" data-search-name="<%= request.user.company&.name %> <%= request.user.name %>">
              <% if current_user.super_admin? %>
                <td><%= request.user.company&.name || '-' %></td>
              <% end %>
              <td><%= request.user.name %></td>
              <td><%= request.store&.name || '-' %></td>
              <td><%= t("activerecord.enums.admin_request.request_type.#{request.request_type}") %></td>
              <td>
                <% if request.pending? %>
                  <span class="badge bg-warning text-dark"><%= t('activerecord.enums.admin_request.status.pending') %></span>
                <% elsif request.approved? %>
                  <span class="badge bg-success"><%= t('activerecord.enums.admin_request.status.approved') %></span>
                <% else %>
                  <span class="badge bg-danger"><%= t('activerecord.enums.admin_request.status.rejected') %></span>
                <% end %>
              </td>
              <td><%= l(request.created_at, format: :long) %></td>
              <td class="text-center">
                <%= link_to scoped_path(:admin_admin_request_path, request),
                    class: 'btn btn-sm btn-outline-primary',
                    title: t('common.show'),
                    data: { turbo: false } do %>
                  <i class="bi bi-eye"></i>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <%= paginate @admin_requests, theme: 'bootstrap-5' %>
  <% else %>
    <div class="alert alert-info" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      <%= t('admin.admin_requests.index.no_requests') %>
    </div>
  <% end %>
</div>
