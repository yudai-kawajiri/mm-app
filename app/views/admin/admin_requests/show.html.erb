<%= content_for(:title, t('admin.admin_requests.show.title')) %>

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h2 class="h4 mb-0"><%= t('admin.admin_requests.show.title') %></h2>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.user_id') %></dt>
            <dd class="col-sm-9"><%= @admin_request.user.name %> (<%= @admin_request.user.email %>)</dd>

            <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.store_id') %></dt>
            <dd class="col-sm-9"><%= @admin_request.store&.name || '-' %></dd>

            <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.request_type') %></dt>
            <dd class="col-sm-9"><%= t("admin.admin_requests.request_type.#{@admin_request.request_type}") %></dd>

            <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.status') %></dt>
            <dd class="col-sm-9">
              <% if @admin_request.status_pending? %>
                <span class="badge bg-warning"><%= t('admin.admin_requests.status.pending') %></span>
              <% elsif @admin_request.status_approved? %>
                <span class="badge bg-success"><%= t('admin.admin_requests.status.approved') %></span>
              <% else %>
                <span class="badge bg-danger"><%= t('admin.admin_requests.status.rejected') %></span>
              <% end %>
            </dd>

            <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.message') %></dt>
            <dd class="col-sm-9"><%= @admin_request.message.presence || '-' %></dd>

            <% if @admin_request.status_approved? || @admin_request.status_rejected? %>
              <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.approved_by_id') %></dt>
              <dd class="col-sm-9"><%= @admin_request.approved_by&.name || '-' %></dd>

              <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.approved_at') %></dt>
              <dd class="col-sm-9"><%= l(@admin_request.approved_at, format: :long) if @admin_request.approved_at %></dd>

              <% if @admin_request.status_rejected? %>
                <dt class="col-sm-3"><%= t('activerecord.attributes.admin_request.rejection_reason') %></dt>
                <dd class="col-sm-9"><%= @admin_request.rejection_reason %></dd>
              <% end %>
            <% end %>
          </dl>

          <div class="d-flex justify-content-between mt-4">
            <%= link_to t('common.back'), admin_admin_requests_path, class: 'btn btn-secondary' %>
            
            <% if @admin_request.can_be_approved? %>
              <div>
                <%= button_to t('admin.admin_requests.show.approve'), 
                    approve_admin_admin_request_path(@admin_request), 
                    method: :post, 
                    class: 'btn btn-success me-2',
                    data: { confirm: t('admin.admin_requests.confirm.approve', name: @admin_request.user.name) } %>
                
                <%= link_to t('admin.admin_requests.show.reject'), '#', 
                    class: 'btn btn-danger',
                    data: { bs_toggle: 'modal', bs_target: '#rejectModal' } %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 却下モーダル -->
<% if @admin_request.can_be_approved? %>
  <div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <%= form_with url: reject_admin_admin_request_path(@admin_request), method: :post, local: true do |f| %>
          <div class="modal-header">
            <h5 class="modal-title"><%= t('admin.admin_requests.show.reject') %></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <%= label_tag 'admin_request[rejection_reason]', 
                  t('admin.admin_requests.show.rejection_reason_label'), 
                  class: 'form-label' %>
              <%= text_area_tag 'admin_request[rejection_reason]', 
                  nil, 
                  rows: 4, 
                  class: 'form-control', 
                  placeholder: t('admin.admin_requests.show.rejection_reason_placeholder'),
                  required: true %>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <%= t('common.cancel') %>
            </button>
            <%= f.submit t('admin.admin_requests.show.reject'), class: 'btn btn-danger' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
