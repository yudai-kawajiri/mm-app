<%# ユーザーフォームのフィールド部分 %>
<% user = local_assigns[:resource] || @user %>

<div class="row" data-controller="admin--user-role">
  <div class="col-md-6">
    <div class="mb-3">
      <%= f.label :name, class: 'form-label h5' do %>
        <%= User.human_attribute_name(:name) %>
        <span class="text-danger">*</span>
      <% end %>
      <%= f.text_field :name, class: 'form-control', placeholder: t('admin.users.form.name_placeholder'), required: true, data: { 'form-validation-target': 'field' } %>
    </div>

    <% if current_user.store_admin? %>
      <%# 店舗管理者: 権限は「一般」固定、非表示 %>
      <%= f.hidden_field :role, value: 'general' %>
      <div class="mb-3">
        <%= f.label :role, class: 'form-label h5' do %>
          <%= User.human_attribute_name(:role) %>
        <% end %>
        <div class="form-control bg-light text-muted" style="cursor: not-allowed;">
          <%= t('admin.users.roles.general') %>
        </div>
        <small class="text-muted"><%= t('admin.users.form.store_admin_role_hint') %></small>
      </div>
    <% else %>
      <%# 会社管理者・システム管理者: 権限選択可能 %>
      <div class="mb-3">
        <%= f.label :role, class: 'form-label h5' do %>
          <%= User.human_attribute_name(:role) %>
          <span class="text-danger">*</span>
        <% end %>
        <%= f.select :role,
            options_for_select([
              [t('admin.users.roles.general'), 'general'],
              [t('admin.users.roles.store_admin'), 'store_admin'],
              [t('admin.users.roles.company_admin'), 'company_admin']
            ], user.role),
            { prompt: t('admin.users.form.role_placeholder') },
            class: 'form-select',
            required: true,
            data: {
              'form-validation-target': 'field',
              'admin--user-role-target': 'roleSelect',
              'action': 'change->admin--user-role#toggleStoreField'
            } %>
      </div>
    <% end %>
  </div>

  <div class="col-md-6">
    <div class="mb-3">
      <%= f.label :email, class: 'form-label h5' do %>
        <%= User.human_attribute_name(:email) %>
        <span class="text-danger">*</span>
      <% end %>
      <%= f.email_field :email, class: 'form-control', placeholder: t('admin.users.form.email_placeholder'), required: true, data: { 'form-validation-target': 'field' } %>
    </div>

    <% if current_user.store_admin? %>
      <%# 店舗管理者: 店舗は固定、非表示 %>
      <%= f.hidden_field :store_id, value: current_user.store_id %>
      <div class="mb-3">
        <%= f.label :store_id, class: 'form-label h5' do %>
          <%= User.human_attribute_name(:store) %>
        <% end %>
        <div class="form-control bg-light text-muted" style="cursor: not-allowed;">
          <%= current_user.store.name %>
        </div>
        <small class="text-muted"><%= t('admin.users.form.store_admin_store_hint') %></small>
      </div>
    <% else %>
      <%# 会社管理者・システム管理者: 店舗選択可能 %>
      <div class="mb-3" data-admin--user-role-target="storeField">
        <%= f.label :store_id, class: 'form-label h5' do %>
          <%= User.human_attribute_name(:store) %>
          <span class="text-danger">*</span>
        <% end %>
        <%= f.collection_select :store_id, @stores, :id, :name,
            { prompt: t('helpers.prompt.select') },
            class: 'form-select',
            data: {
              'form-validation-target': 'field',
              'admin--user-role-target': 'storeSelect'
            } %>
      </div>
    <% end %>
  </div>
</div>

<div class="row mt-3">
  <div class="col-md-6">
    <div class="mb-3">
      <%= f.label :password, class: 'form-label h5' do %>
        <%= user.new_record? ? User.human_attribute_name(:password) : t('devise.registrations.edit.new_password') %>
      <% end %>
      <%= f.password_field :password, class: 'form-control', autocomplete: 'new-password', placeholder: t('devise.shared.minimum_password_length', count: 6) %>
      <small class="text-muted">
        <%= user.new_record? ? t('admin.users.form.password_hint') : t('devise.registrations.edit.leave_blank_if_you_don_t_want_to_change_it') %>
      </small>
    </div>
  </div>

  <div class="col-md-6">
    <div class="mb-3">
      <%= f.label :password_confirmation, class: 'form-label h5' do %>
        <%= User.human_attribute_name(:password_confirmation) %>
      <% end %>
      <%= f.password_field :password_confirmation, class: 'form-control', autocomplete: 'new-password', placeholder: t('devise.shared.minimum_password_length', count: 6) %>
    </div>
  </div>
</div>
