<% content_for :title, t('help.title') %>

<div class="container-fluid py-4" data-controller="help-search video-modal">
  <div class="row mb-4">
    <div class="col-12">
      <h1><%= t('help.title') %></h1>
      <p class="text-muted"><%= t('help.subtitle') %></p>
    </div>
  </div>

  <!-- 検索ボックス(左寄せ) -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text"
               class="form-control"
               id="helpSearch"
               placeholder="<%= t('help.search.placeholder') %>"
               data-help-search-target="input"
               data-action="input->help-search#search">
      </div>
    </div>
  </div>

  <!-- 使い方動画セクション -->
  <section class="mb-5">
    <h2 class="border-bottom pb-2 mb-4"><%= t('help.sections.videos') %></h2>

    <!-- 動画が見つからない場合のメッセージ -->
    <div class="alert alert-info d-none" id="noVideosFound" data-help-search-target="noVideosFound">
      <%= t('help.search.no_videos_found') %>
    </div>

    <!-- 基本操作(初期状態: 折りたたみ) -->
    <div class="mb-3" data-help-search-target="videoCategory">
      <h5 class="mb-2">
        <a class="text-decoration-none d-block"
           data-bs-toggle="collapse"
           href="#collapseBasic"
           role="button"
           aria-expanded="false"
           aria-controls="collapseBasic">
          ▶ <%= t('help.categories.basic_operations') %>
        </a>
      </h5>
      <div class="collapse" id="collapseBasic">
        <div class="row g-3">
          <div class="col-md-4" data-keywords="<%= t('help.video_keywords.search_function') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.search_function.youtube_id') %>" data-video-title="<%= t('help.videos.search_function.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.search_function.title') %></h6>
                <p class="card-text small"><%= t('help.videos.search_function.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4" data-keywords="<%= t('help.video_keywords.copy_function') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.copy_function.youtube_id') %>" data-video-title="<%= t('help.videos.copy_function.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.copy_function.title') %></h6>
                <p class="card-text small"><%= t('help.videos.copy_function.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4" data-keywords="<%= t('help.video_keywords.print_function') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.print_function.youtube_id') %>" data-video-title="<%= t('help.videos.print_function.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.print_function.title') %></h6>
                <p class="card-text small"><%= t('help.videos.print_function.description') %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 数値管理(初期状態: 折りたたみ) -->
    <div class="mb-3" data-help-search-target="videoCategory">
      <h5 class="mb-2">
        <a class="text-decoration-none d-block"
           data-bs-toggle="collapse"
           href="#collapseNumerical"
           role="button"
           aria-expanded="false"
           aria-controls="collapseNumerical">
          ▶ <%= t('help.categories.numerical_management') %>
        </a>
      </h5>
      <div class="collapse" id="collapseNumerical">
        <div class="row g-3">
          <div class="col-md-3" data-keywords="<%= t('help.video_keywords.monthly_budget') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.monthly_budget.youtube_id') %>" data-video-title="<%= t('help.videos.monthly_budget.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.monthly_budget.title') %></h6>
                <p class="card-text small"><%= t('help.videos.monthly_budget.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-3" data-keywords="<%= t('help.video_keywords.daily_target') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.daily_target.youtube_id') %>" data-video-title="<%= t('help.videos.daily_target.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.daily_target.title') %></h6>
                <p class="card-text small"><%= t('help.videos.daily_target.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-3" data-keywords="<%= t('help.video_keywords.actual_confirmation') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.actual_confirmation.youtube_id') %>" data-video-title="<%= t('help.videos.actual_confirmation.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.actual_confirmation.title') %></h6>
                <p class="card-text small"><%= t('help.videos.actual_confirmation.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-3" data-keywords="<%= t('help.video_keywords.bulk_edit') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.bulk_edit.youtube_id') %>" data-video-title="<%= t('help.videos.bulk_edit.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.bulk_edit.title') %></h6>
                <p class="card-text small"><%= t('help.videos.bulk_edit.description') %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- リソース管理(初期状態: 折りたたみ) -->
    <div class="mb-3" data-help-search-target="videoCategory">
      <h5 class="mb-2">
        <a class="text-decoration-none d-block"
           data-bs-toggle="collapse"
           href="#collapseResource"
           role="button"
           aria-expanded="false"
           aria-controls="collapseResource">
          ▶ <%= t('help.categories.resource_management') %>
        </a>
      </h5>
      <div class="collapse" id="collapseResource">
        <div class="row g-3">
          <div class="col-md-4 col-lg-3" data-keywords="<%= t('help.video_keywords.category') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.category.youtube_id') %>" data-video-title="<%= t('help.videos.category.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.category.title') %></h6>
                <p class="card-text small"><%= t('help.videos.category.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-3" data-keywords="<%= t('help.video_keywords.unit') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.unit.youtube_id') %>" data-video-title="<%= t('help.videos.unit.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.unit.title') %></h6>
                <p class="card-text small"><%= t('help.videos.unit.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-2" data-keywords="<%= t('help.video_keywords.material') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.material.youtube_id') %>" data-video-title="<%= t('help.videos.material.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.material.title') %></h6>
                <p class="card-text small"><%= t('help.videos.material.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-2" data-keywords="<%= t('help.video_keywords.order_group') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.order_group.youtube_id') %>" data-video-title="<%= t('help.videos.order_group.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.order_group.title') %></h6>
                <p class="card-text small"><%= t('help.videos.order_group.description') %></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-2" data-keywords="<%= t('help.video_keywords.product') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.product.youtube_id') %>" data-video-title="<%= t('help.videos.product.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.product.title') %></h6>
                <p class="card-text small"><%= t('help.videos.product.description') %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 製造計画(初期状態: 折りたたみ) -->
    <div class="mb-3" data-help-search-target="videoCategory">
      <h5 class="mb-2">
        <a class="text-decoration-none d-block"
           data-bs-toggle="collapse"
           href="#collapsePlan"
           role="button"
           aria-expanded="false"
           aria-controls="collapsePlan">
          ▶ <%= t('help.categories.production_planning') %>
        </a>
      </h5>
      <div class="collapse" id="collapsePlan">
        <div class="row g-3">
          <div class="col-md-6" data-keywords="<%= t('help.video_keywords.plan') %>" data-help-search-target="videoItem">
            <div class="card h-100 shadow-sm" style="cursor: pointer;" data-action="click->video-modal#open" data-youtube-id="<%= t('help.videos.plan.youtube_id') %>" data-video-title="<%= t('help.videos.plan.title') %>" data-preparing-message="<%= t('help.video_modal.preparing') %>">
              <div class="card-body">
                <h6 class="card-title"><%= t('help.videos.plan.title') %></h6>
                <p class="card-text small"><%= t('help.videos.plan.description') %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- よくある質問セクション -->
  <section class="mb-5">
    <h2 class="border-bottom pb-2 mb-4"><%= t('help.sections.faq') %></h2>

    <div class="accordion" id="faqAccordion">
      <%= render 'faq_items' %>
    </div>

    <!-- FAQが見つからない場合のメッセージ -->
    <div class="alert alert-info mt-3 d-none" id="noFaqFound" data-help-search-target="noFaqFound">
      <%= t('help.search.no_faq_found') %>
    </div>
  </section>

  <!-- 検索結果なしメッセージ -->
  <div class="alert alert-warning d-none" id="noResultsFound" data-help-search-target="noResultsFound">
    「<strong id="searchKeyword" data-help-search-target="searchKeyword"></strong>」<%= t('help.search.no_results_found') %>
  </div>
</div>

<!-- 動画モーダル -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true" data-video-modal-target="modal">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="videoModalLabel" data-video-modal-target="title"><%= t('help.video_modal.default_title') %></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-action="click->video-modal#close"></button>
      </div>
      <div class="modal-body p-0">
        <div class="ratio ratio-16x9">
          <iframe data-video-modal-target="iframe" src="" title="YouTube video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>
</div>
