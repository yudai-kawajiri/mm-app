<%# 予算設定モーダル %>

<div class="modal fade" id="budgetSettingModal" tabindex="-1" aria-labelledby="budgetSettingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <% if @monthly_budget&.persisted? %>
        <%= form_with model: @monthly_budget,
                      scope: :monthly_budget,
                      url: management_monthly_budget_path(@monthly_budget),
                      method: :patch do |f| %>
          <div class="modal-header">
            <h5 class="modal-title" id="budgetSettingModalLabel"><%= t('numerical_managements.modals.budget_setting.title') %></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label"><%= t('numerical_managements.modals.labels.target_month') %></label>
              <input type="text" class="form-control-plaintext" value="<%= l(@selected_date, format: :year_month) %>" readonly>
            </div>

            <div class="mb-3">
              <%= f.label :target_amount, t('numerical_managements.modals.fields.monthly_budget'), class: "form-label" %>
              <%= f.text_field :target_amount,
                      value: @monthly_budget.target_amount.to_i,
                      class: "form-control monthly-budget-input",
                      required: true,
                      id: "editMonthlyBudgetAmount",
                      inputmode: "numeric",
                      autocomplete: "off",
                      data: {
                        controller: 'input--number-input',
                        action: 'input->input--number-input#handleInput paste->input--number-input#handlePaste focus->input--number-input#handleFocus blur->input--number-input#handleBlur',
                        original_value: @monthly_budget.target_amount.to_i
                      } %>
            </div>

            <div class="mb-3">
              <%= f.label :description, t('activerecord.attributes.management/monthly_budget.description'), class: "form-label" %>
              <div data-controller="input--character-counter" data-input--character-counter-max-value="<%= Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH %>">
                <%= f.text_area :description,
                      class: "form-control",
                      rows: Management::MonthlyBudget::DESCRIPTION_ROWS,
                      maxlength: Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH,
                      data: {
                        input__character_counter_target: "input",
                        action: "input->input--character-counter#updateCount"
                      } %>
                <div class="form-text text-end">
                  <span data-input--character-counter-target="count">0</span> /
                  <span data-input--character-counter-target="remaining"><%= Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH %></span>
                  文字
                </div>
              </div>
            </div>

            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle"></i> <%= t('numerical_managements.modals.budget_setting.info') %>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= t('common.cancel') %></button>
            <%= f.submit t('common.update'), class: "btn btn-primary" %>
          </div>
        <% end %>
      <% else %>
        <%= form_with url: management_monthly_budgets_path, method: :post, scope: :monthly_budget do |f| %>
          <%= hidden_field_tag :year, @selected_date.year %>
          <%= hidden_field_tag :month, @selected_date.month %>
          <%= hidden_field_tag :return_to, 'index' %>

          <div class="modal-header">
            <h5 class="modal-title" id="budgetSettingModalLabel"><%= t('numerical_managements.modals.budget_setting.title') %></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label"><%= t('numerical_managements.modals.labels.target_month') %></label>
              <input type="text" class="form-control-plaintext" value="<%= l(@selected_date, format: :year_month) %>" readonly>
            </div>

            <div class="mb-3">
              <%= label_tag 'monthly_budget[target_amount]', t('numerical_managements.modals.fields.monthly_budget'), class: "form-label" %>
              <%= text_field_tag 'monthly_budget[target_amount]',
                nil,
                class: "form-control monthly-budget-input",
                required: true,
                id: "newMonthlyBudgetAmount",
                inputmode: "numeric",
                autocomplete: "off",
                data: {
                  controller: 'input--number-input',
                  action: 'input->input--number-input#handleInput paste->input--number-input#handlePaste focus->input--number-input#handleFocus blur->input--number-input#handleBlur'
                } %>
            </div>

            <div class="mb-3">
              <%= label_tag 'monthly_budget[description]', t('activerecord.attributes.management/monthly_budget.description'), class: "form-label" %>
              <div data-controller="input--character-counter" data-input--character-counter-max-value="<%= Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH %>">
                <%= text_area_tag 'monthly_budget[description]',
                      nil,
                      class: "form-control",
                      rows: Management::MonthlyBudget::DESCRIPTION_ROWS,
                      maxlength: Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH,
                      data: {
                        input__character_counter_target: "input",
                        action: "input->input--character-counter#updateCount"
                      } %>
                <div class="form-text text-end">
                  <span data-input--character-counter-target="count">0</span> /
                  <span data-input--character-counter-target="remaining"><%= Management::MonthlyBudget::DESCRIPTION_MAX_LENGTH %></span>
                  文字
                </div>
              </div>
            </div>

            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle"></i> <%= t('numerical_managements.modals.budget_setting.info') %>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= t('common.cancel') %></button>
            <%= submit_tag t('common.create'), class: "btn btn-primary" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
