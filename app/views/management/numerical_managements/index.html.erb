<%# 売上管理メイン画面 %>
<% content_for :title, t('numerical_managements.index.title') %>

<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0"><%= t('numerical_managements.index.title') %></h1>

    <div class="d-flex align-items-center gap-3">
      <form method="get" class="d-flex align-items-center gap-2">
        <label class="text-muted mb-0"><%= t('numerical_managements.index.target_month') %></label>

        <div class="d-flex gap-1">
          <select name="year" class="form-select form-select-sm" style="width: 90px;">
            <% (Date.current.year - 2..Date.current.year + 1).each do |year| %>
              <option value="<%= year %>" <%= 'selected' if year == @selected_date.year %>><%= year %>年</option>
            <% end %>
          </select>

          <select name="month" class="form-select form-select-sm" style="width: 80px;">
            <% (1..12).each do |month| %>
              <option value="<%= month %>" <%= 'selected' if month == @selected_date.month %>><%= month %>月</option>
            <% end %>
          </select>
        </div>

        <button type="submit" class="btn btn-primary btn-sm"><%= t('numerical_managements.index.display') %></button>
      </form>

      <div class="d-flex gap-2">
        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#budgetSettingModal">
          <i class="bi bi-gear"></i> <%= t('numerical_managements.index.set_budget') %>
        </button>

        <% if @monthly_budget&.persisted? %>
          <%= button_to scoped_path(:management_monthly_budget_path)(@monthly_budget),
                        method: :delete,
                        form: { data: { turbo_confirm: t('numerical_managements.modals.confirm.delete') } },
                        class: "btn btn-outline-danger btn-sm" do %>
            <i class="bi bi-trash"></i> <%= t('numerical_managements.index.delete_budget') %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <%= render 'shared/summary_cards', forecast_data: @forecast_data, monthly_budget: @monthly_budget %>
  <%= render 'forecast_cards', forecast_data: @forecast_data %>
  <%= render 'daily_details_table', daily_data: @daily_data %>
</div>

<%# 各種モーダルの読み込み %>
<%= render 'budget_setting_modal' %>
<%= render 'daily_target_modal' %>
<%= render 'actual_revenue_modal' %>
<%= render 'assign_plan_modal', plans_by_category: @plans_by_category %>
<%= render 'discount_rate_modal' %>
