<!-- 予算設定モーダル -->
<div class="modal fade" id="budgetSettingModal" tabindex="-1" aria-labelledby="budgetSettingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <% if @monthly_budget&.persisted? %>
        <%# 既存予算の更新（PATCH） %>
        <%= form_with model: @monthly_budget,
                      url: monthly_budget_path(@monthly_budget),
                      method: :patch,
                      local: true do |f| %>
          <%= hidden_field_tag :return_to, 'index' %>

          <div class="modal-header">
            <h5 class="modal-title" id="budgetSettingModalLabel"><%= t('numerical_managements.modals.budget_setting.title') %></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label"><%= t('numerical_managements.modals.labels.target_month') %></label>
              <input type="text" class="form-control-plaintext" value="<%= @selected_date.strftime('%Y年%m月') %>" readonly>
            </div>

            <div class="mb-3">
              <%= f.label :target_amount, t('numerical_managements.modals.fields.monthly_budget'), class: "form-label" %>
              <%= f.text_field :target_amount,
                      value: @monthly_budget.target_amount.to_i,
                      class: "form-control",
                      required: true,
                      placeholder: t('numerical_managements.placeholders.budget_amount'),
                      inputmode: "numeric",
                      data: {
                        controller: 'number-input',
                        action: 'input->number-input#handleInput paste->number-input#handlePaste'
                      } %>
            </div>

            <div class="mb-3">
              <%= f.label :note, t('numerical_managements.modals.labels.note'), class: "form-label" %>
              <%= f.text_area :note, class: "form-control", rows: 3 %>
            </div>

            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle"></i> <%= t('numerical_managements.modals.budget_setting.info') %>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= t('common.cancel') %></button>
            <%= f.submit t('common.update'), class: "btn btn-primary" %>
          </div>
        <% end %>
      <% else %>
        <%# 新規予算の作成（POST） %>
        <%= form_with url: monthly_budgets_path, method: :post, local: true do |f| %>
          <%= hidden_field_tag :year, @selected_date.year %>
          <%= hidden_field_tag :month, @selected_date.month %>
          <%= hidden_field_tag :return_to, 'index' %>

          <div class="modal-header">
            <h5 class="modal-title" id="budgetSettingModalLabel"><%= t('numerical_managements.modals.budget_setting.title') %></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label"><%= t('numerical_managements.modals.labels.target_month') %></label>
              <input type="text" class="form-control-plaintext" value="<%= @selected_date.strftime('%Y年%m月') %>" readonly>
            </div>

            <div class="mb-3">
              <%= label_tag 'monthly_budget[target_amount]', t('numerical_managements.modals.fields.monthly_budget'), class: "form-label" %>
              <%= text_field_tag 'monthly_budget[target_amount]',
                nil,
                class: "form-control",
                required: true,
                placeholder: t('numerical_managements.placeholders.budget_amount'),
                inputmode: "numeric",
                data: {
                  controller: 'number-input',
                  action: 'input->number-input#handleInput paste->number-input#handlePaste'
                } %>
            </div>

            <div class="mb-3">
              <%= label_tag 'monthly_budget[note]', t('numerical_managements.modals.labels.note'), class: "form-label" %>
              <%= text_area_tag 'monthly_budget[note]', nil, class: "form-control", rows: 3 %>
            </div>

            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle"></i> <%= t('numerical_managements.modals.budget_setting.info') %>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= t('common.cancel') %></button>
            <%= submit_tag t('common.create'), class: "btn btn-primary" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>