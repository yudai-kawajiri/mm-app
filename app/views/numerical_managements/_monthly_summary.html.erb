<!-- 月間サマリー -->
<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title"><%= t('numerical_managements.calendar.monthly_summary') %></h5>

    <div class="row">
      <%
        monthly_target = calendar_data.flatten.compact.sum { |day| (day[:target] || 0).to_i }
        monthly_actual = calendar_data.flatten.compact.sum { |day| (day[:actual] || 0).to_i }
        monthly_achievement = if monthly_target > 0
                                ((monthly_actual.to_f / monthly_target) * 100).round(1)
                              else
                                0
                              end

        summary_badge_class = if monthly_achievement >= 100
                                'bg-success'
                              elsif monthly_achievement >= 80
                                'bg-warning text-dark'
                              else
                                'bg-danger'
                              end
      %>

      <div class="col-md-3">
        <div class="text-muted small"><%= t('numerical_managements.calendar.monthly_budget') %></div>
        <div class="h5">¥<%= number_with_delimiter(monthly_target.to_i) %></div>
      </div>

      <div class="col-md-3">
        <div class="text-muted small"><%= t('numerical_managements.calendar.monthly_actual') %></div>
        <div class="h5">¥<%= number_with_delimiter(monthly_actual.to_i) %></div>
      </div>

      <div class="col-md-3">
        <div class="text-muted small"><%= t('numerical_managements.calendar.budget_diff') %></div>
        <div class="h5 <%= monthly_actual >= monthly_target ? 'text-success' : 'text-danger' %>">
          ¥<%= number_with_delimiter((monthly_actual - monthly_target).to_i) %>
        </div>
      </div>

      <div class="col-md-3">
        <div class="text-muted small"><%= t('numerical_managements.calendar.monthly_achievement_rate') %></div>
        <div class="h5">
          <span class="badge <%= summary_badge_class %>">
            <%= monthly_achievement %>%
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
