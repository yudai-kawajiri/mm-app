<% content_for :title, t('numerical_managements.index.title') %>

<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0"><%= t('numerical_managements.index.title') %></h1>

    <div class="d-flex align-items-center gap-3">
      <!-- 月選択フォーム -->
      <form method="get" class="d-flex align-items-center gap-2">
        <label class="text-muted mb-0"><%= t('numerical_managements.index.target_month') %></label>
        <input type="month" name="month" value="<%= @selected_date.strftime('%Y-%m') %>" class="form-control form-control-sm" style="width: 150px;">
        <button type="submit" class="btn btn-primary btn-sm"><%= t('numerical_managements.index.display') %></button>
      </form>

      <!-- カレンダービューへのリンク -->
      <%= link_to t('numerical_managements.index.calendar_view'), calendar_numerical_managements_path(month: @selected_date.strftime('%Y-%m')), class: "btn btn-outline-primary btn-sm" %>

      <!-- 予算設定ボタン -->
      <div class="d-flex gap-2">
        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#budgetSettingModal">
          <i class="bi bi-gear"></i> <%= t('numerical_managements.index.set_budget') %>
        </button>

        <% if @monthly_budget&.persisted? %>
          <%= button_to monthly_budget_path(@monthly_budget),
                        method: :delete,
                        data: {
                          turbo_confirm: t('numerical_managements.modals.delete_confirm')
                        },
                        class: "btn btn-outline-danger btn-sm" do %>
            <i class="bi bi-trash"></i> <%= t('numerical_managements.index.delete_budget') %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <%= render 'summary_cards', forecast_data: @forecast_data %>

  <%= render 'forecast_cards', forecast_data: @forecast_data %>

  <%= render 'daily_details_table', daily_data: @daily_data %>
</div>

<%= render 'budget_setting_modal', selected_date: @selected_date, budget: @budget %>
