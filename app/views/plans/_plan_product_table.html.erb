<% plan_products = local_assigns[:plan_products] %>

<% if plan_products.present? %>
  <table class="table table-sm table-borderless">
    <thead>
      <tr class="border-bottom">
        <th><%= t('activerecord.attributes.product_plan.product_name', default: '商品名') %></th>
        <th class="text-end"><%= t('activerecord.attributes.product_plan.production_count', default: '数量') %></th>
        <th class="text-end text-muted"><%= t('activerecord.attributes.product.price', default: '売価') %></th>
        <th class="text-end text-dark"><%= t('views.common.subtotal', default: '小計') %></th>
      </tr>
    </thead>
    <tbody>
      <% (plan_products || []).each do |pp| %>
        <tr class="border-bottom">
          <%# 商品名: 未　pp.productがnilの場合に備え　%>
          <td><%= pp.product&.name %></td>

          <%# 生産数 %>
          <td class="text-end"><%= pp.production_count %></td>

          <%# 売価: 未 安全アクセス (&.) と小数点抑制を適用 %>
          <td class="text-end text-muted"><%= number_to_currency(pp.product&.price, precision: 0) %></td>

          <%# 小計%>
          <td class="text-end text-dark">
            <% subtotal = pp.production_count * (pp.product&.price || 0) %>
            <%= number_to_currency(subtotal, precision: 0) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-muted text-center" style="padding-top: 50px; font-size: 1.0em;">
    <%#  メッセージキ－%>
    <%= t('plans.product_fields.no_products_set', default: '製造商品はまだ設定されていません。') %>
  </p>
<% end %>