<%# 基本情報 - すべてを1つのカードに統合 %>
<div class="card mb-3">
  <div class="card-header bg-light">
    <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>基本情報</h5>
  </div>
  <div class="card-body">
    <div class="row g-3">
      <%# 左カラム %>
      <div class="col-md-6">
        <%# 1. 商品名 %>
        <%= form_group_lg(f, :name) %>

        <%# 2. 品番 %>
        <%= form_group_lg(f, :item_number) %>

        <%# 3. 売価 %>
        <div class="mb-3">
          <%= form_label_lg(f, :price) %>
          <div class="input-group input-group-lg">
            <span class="input-group-text"><%= t('number.currency.format.unit') %></span>
            <%= f.number_field :price, class: "form-control", step: 0.01, min: 0 %>
          </div>
        </div>

        <%# 4. 説明 %>
        <div class="mb-3">
          <%= form_label_lg(f, :description) %>
          <%= f.text_area :description,
              class: "form-control",
              rows: 4,
              maxlength: 1000,
              data: {
                controller: "character-counter",
                character_counter_max_value: 1000,
                character_counter_warning_value: 20,
                character_counter_danger_value: 10
              } %>
          <div class="form-text d-flex justify-content-between align-items-center mt-1">
            <span><%= t('helpers.character_counter.hint', max: 1000) %></span>
            <span data-character-counter-target="counter" class="badge bg-secondary"></span>
          </div>
          <% if f.object.errors[:description].any? %>
            <div class="invalid-feedback d-block">
              <%= f.object.errors[:description].first %>
            </div>
          <% end %>
        </div>
      </div>

      <%# 右カラム %>
      <div class="col-md-6">
        <%# 5. カテゴリ %>
        <%= form_group_lg(f, :category_id,
                          field_type: :collection_select,
                          collection: @product_categories,
                          value_method: :id,
                          text_method: :name) %>

        <%# 6. ステータス %>
        <%= form_group_lg(f, :status,
                          field_type: :select,
                          choices: Product.statuses.keys.map { |status| [t("activerecord.enums.product.status.#{status}"), status] }) %>

        <%# 7. 画像 %>
        <div class="mb-3">
          <%= form_label_lg(f, :image) %>
          <%= f.file_field :image,
              id: 'product-image-input',
              class: "form-control",
              accept: "image/*",
              data: {
                controller: "image-preview",
                action: "change->image-preview#preview"
              } %>
          <small class="text-muted d-block mt-1">
            <% if f.object.persisted? && f.object.image.attached? %>
              <%= t('products.image_help.change') %>
            <% else %>
              <%= t('products.image_help.select') %>
            <% end %>
          </small>
          <% if f.object.errors[:image].any? %>
            <div class="invalid-feedback d-block">
              <%= f.object.errors[:image].first %>
            </div>
          <% end %>

          <%# 画像プレビュー %>
          <div class="text-center mt-2" data-image-preview-target="container">
            <% if f.object.persisted? && f.object.image.attached? %>
              <div class="mb-2">
                <%= image_tag f.object.image,
                    id: 'image-preview',
                    style: "max-width: 100%; max-height: 200px; height: auto;",
                    class: "img-thumbnail",
                    data: { existing_image: 'true' } %>
              </div>

              <%# 既存画像の削除ボタン %>
              <div id="current-image-container-<%= f.object.id %>">
                <%= link_to t('helpers.link.delete_image'), "#",
                  data: { product_id: f.object.id, url: purge_image_product_path(f.object) },
                  class: "btn btn-sm btn-danger",
                  id: "delete-button-#{f.object.id}" %>
              </div>
            <% else %>
              <%= image_tag '',
                  id: 'image-preview',
                  style: "max-width: 100%; max-height: 200px; height: auto; display: none;",
                  class: "img-thumbnail",
                  data: { existing_image: 'false' } %>
            <% end %>

            <div id="new-image-action" style="display: none;">
              <button type="button" id="cancel-new-image-button" class="btn btn-sm btn-outline-danger">
                <%= t('helpers.link.cancel_new_image') %>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>