<div data-controller="resources--product-material--material form--nested-form tabs--category-tabs"
Â  Â  Â data-resources--product-material--material-target="totalContainer">

Â  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex justify-content-start align-items-center">
      <%= select_tag("category_selector",
          options_from_collection_for_select(@material_categories, :id, :name),
          # ğŸ’¡ ã“ã“ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç›´æ¥è¨˜è¿°ã—ã€æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’å›é¿
          prompt: 'ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ',
          class: 'form-select me-2',
          style: 'width: 250px;',
          data: {
            # ğŸ’¡ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©åã‚’ä¿®æ­£
            'tabs--category-tabs-target': 'categorySelector',
            'action': 'change->tabs--category-tabs#toggleButton'
          }
      ) %>
Â  Â  Â  <button type="button"
Â  Â  Â  Â  Â  Â  Â  class="btn btn-primary"
Â  Â  Â  Â  Â  Â  Â  data-action="click->tabs--category-tabs#showSelectedTab"
Â  Â  Â  Â  Â  Â  Â  data-tabs--category-tabs-target="showButton"
Â  Â  Â  Â  Â  Â  Â  disabled>
Â  Â  Â  Â  ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã‚’è¿½åŠ 
      </button>
    </div>
  </div>

  <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="nav nav-tabs" role="tablist" data-tabs--category-tabs-target="tabNav">
    <!-- ALLã‚¿ãƒ–ï¼ˆå‰Šé™¤ä¸å¯ï¼‰ -->
    <button class="nav-link active"
            id="nav-0-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-0"
            type="button"
            role="tab"
            aria-controls="nav-0"
            aria-selected="true"
            data-category-id="0">
      å…¨ã¦
    </button>

    <!-- æ—¢å­˜ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆÃ—ãƒœã‚¿ãƒ³ä»˜ãï¼‰ -->
    <% displayed_category_ids = @product.product_materials.map { |pm| pm.material&.category_id }.compact.uniq %>
    <% @material_categories.select { |c| displayed_category_ids.include?(c.id) }.each do |category| %>
      <button class="nav-link position-relative"
              id="nav-<%= category.id %>-tab"
              data-bs-toggle="tab"
              data-bs-target="#nav-<%= category.id %>"
              type="button"
              role="tab"
              aria-controls="nav-<%= category.id %>"
              aria-selected="false"
              data-category-id="<%= category.id %>"
              style="padding-right: 2.5rem;">
        <%= category.name %>
        <span class="position-absolute top-50 end-0 translate-middle-y pe-2"
              style="cursor: pointer; font-weight: bold; color: #dc3545;"
              data-action="click->tabs--category-tabs#removeTab"
              data-category-id="<%= category.id %>">
          Ã—
        </span>
      </button>
    <% end %>
  </div>

  <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="tab-content pt-3" data-tabs--category-tabs-target="contentContainer">
    <!-- ALLã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="tab-pane fade show active"
         id="nav-0"
         role="tabpanel"
         aria-labelledby="nav-0-tab"
         data-category-id="0">
      <%= render 'shared/components/tabs/material_category_tab_content',
          category_id: 0,
          category_name: 'ã™ã¹ã¦',
          product: @product,
          material_categories: @material_categories,
          f: f %>
    </div>

    <!-- æ—¢å­˜ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <% @material_categories.select { |c| displayed_category_ids.include?(c.id) }.each do |category| %>
      <div class="tab-pane fade"
           id="nav-<%= category.id %>"
           role="tabpanel"
           aria-labelledby="nav-<%= category.id %>-tab"
           data-category-id="<%= category.id %>">
        <%= render 'shared/components/tabs/material_category_tab_content',
            category_id: category.id,
            category_name: category.name,
            product: @product,
            material_categories: @material_categories,
            f: f %>
      </div>
    <% end %>
  </div>

  <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
  <template data-tabs--category-tabs-target="categoryTemplate">
    <button class="nav-link position-relative"
            id="nav-CATEGORY_ID_PLACEHOLDER-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-CATEGORY_ID_PLACEHOLDER"
            type="button"
            role="tab"
            aria-controls="nav-CATEGORY_ID_PLACEHOLDER"
            aria-selected="false"
            data-category-id="CATEGORY_ID_PLACEHOLDER"
            style="padding-right: 2.5rem;">
      CATEGORY_NAME_PLACEHOLDER
      <span class="position-absolute top-50 end-0 translate-middle-y pe-2"
            style="cursor: pointer; font-weight: bold; color: #dc3545;"
            data-action="click->tabs--category-tabs#removeTab"
            data-category-id="CATEGORY_ID_PLACEHOLDER">
        Ã—
      </span>
    </button>
  </template>

  <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <template data-tabs--category-tabs-target="categoryPaneTemplate">
    <div class="tab-pane fade"
         id="nav-CATEGORY_ID_PLACEHOLDER"
         role="tabpanel"
         aria-labelledby="nav-CATEGORY_ID_PLACEHOLDER-tab"
         data-category-id="CATEGORY_ID_PLACEHOLDER">

      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th style="width: 35%;">åŸææ–™å</th>
              <th style="width: 15%;">æ•°é‡</th>
              <th style="width: 20%;">å•†å“å˜ä½é‡é‡</th>
              <th style="width: 20%;">å˜ä½</th>
              <th style="width: 10%;" class="text-end">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
          </thead>
          <tbody data-form--nested-form-target="target" data-category-id="CATEGORY_ID_PLACEHOLDER">
            <!-- åŸææ–™è¡ŒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
          </tbody>
        </table>

        <div class="mt-3">
          <button type="button"
                  class="btn btn-outline-success w-100"
                  data-category-id="CATEGORY_ID_PLACEHOLDER"
                  data-template-id="product_material_fields_template_CATEGORY_ID_PLACEHOLDER"
                  data-action="click->form--nested-form#add">
            åŸææ–™ã‚’è¿½åŠ 
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- åŸææ–™è¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå„ã‚«ãƒ†ã‚´ãƒªç”¨ï¼‰ -->
  <% @material_categories.each do |category| %>
    <template id="product_material_fields_template_<%= category.id %>" data-form--nested-form-target="template">
      <%= f.fields_for :product_materials,
          @product.product_materials.build(material: Material.new(category_id: category.id)),
          child_index: 'NEW_RECORD' do |material_f| %>
        <%= render 'product_material_fields', f: material_f, category_id: category.id %>
      <% end %>
    </template>
  <% end %>

</div>
