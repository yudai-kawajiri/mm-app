<%#
  機能: 商品一覧画面
  - 全商品の一覧表示
  - カテゴリ検索機能
  - ドラッグ&ドロップ並び替え機能
  - コピー機能
%>
<%= content_for(:title, t('products.index.title')) %>

<%= render 'shared/layouts/header_with_actions',
    title: t('products.index.title'),
    resource: nil,
    is_index_page: true,
    is_form_page: false,
    is_show_page: false,
    new_path: new_product_path %>

<div data-controller="sortable-table"
      data-sortable-table-reorder-path-value="<%= reorder_products_path %>"
      data-sortable-table-param-name-value="product_ids">

  <%= render 'shared/sortable_buttons' %>

  <%= render('shared/components/resource_list',
      resources: @products,
      resource_class: Product,
      search_target: :category_id,
      search_categories: @product_categories,
      show_copy: true,
      copy_url_method: :copy_product_path,
      icon_mode: true,

      columns: [
        { header: '',
          data: Proc.new { |product|
            content_tag(:span, '☰', class: 'drag-handle d-none', style: 'cursor: move; font-size: 1.2em; color: #999;')
          }
        },
        { header: :image, data: :image },
        { header: :name, data: :name },
        { header: :category_id,
          data: Proc.new { |product| product.category&.name }
        },
        { header: :item_number, data: :item_number },
        { header: :price, data: :price },
        { header: :status,
          data: Proc.new { |product| translate_enum_value(product, :status) }
        }
      ],
      tbody_data: { sortable_table_target: 'tbody' }
  ) %>

  <%= paginate @products, theme: 'bootstrap-5' %>
</div>
