<%# 必須引数: title, resources, columns, resource_class :search_target, :resource_class %>
<%# オプション引数: new_path %>
<%# 必要なローカル変数を定義 %>
<% search_target = local_assigns[:search_target] %>
<% resource_class = local_assigns[:resource_class] %>

<%= content_for :page_title, title %>

<%# 1. ページタイトルと新規作成ボタンのエリア %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><%= title %></h2>

  <%= link_to t('helpers.link.new'),
              new_path,
              class: 'btn btn-primary' %>
</div>

<%# 2.検索フォーム %>
<% if search_target.present? %>
  <%= render 'shared/search_form',
      # resource_class (Product) からルーティングパス (products_path) を動的に生成
      form_path: send(resource_class.model_name.route_key + '_path'),
      search_target: search_target %>
<% end %>

<%# 3. テーブル全体の描画 %>
<table class="table mt-4">
  <thead class="table-light">
    <tr>
      <%# ヘッダー行 %>
      <% columns.each do |col| %>
        <%# ヘッダーは 'header' キーを参照 %>
        <th><%= resource_class.human_attribute_name(col[:header]) %></th>
      <% end %>
      <th><%= t('common.action') %></th>
    </tr>
  </thead>
  <tbody>
    <%# データ行 %>
    <% resources.each do |resource| %>
      <tr>
        <%# データ描画 %>
        <% columns.each do |col| %>
          <td>
            <%# 1. 画像カラムの場合の専用処理 　未: 画像なしサムネイル%>
            <% if col[:data] == :image %>
              <% if resource.image.attached? %>
                <%= image_tag resource.image.variant(resize_to_limit: [50, 50]), class: "img-thumbnail"%>
              <% else %>
                -
              <% end %>

            <%# 2. 金額表示カラムの専用処理 %>
            <% elsif col[:data] == :price %>
              <%= number_to_currency(resource.price) %>

            <%# 3. 通常のカラム %>
            <% else %>
              <%= resource.send(col[:data]) %>
            <% end %>
          </td>
        <% end %>

        <%# アクションカラム %>
        <td>
          <%= render 'shared/actions/action_links',
              resource: resource,
              resource_name: resource.class.model_name.human,
              show_link: defined?(show_action_link) ? show_action_link : true
          %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
