<% if is_form_page %>
  <!-- ========================================
       ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ï¼ˆæ–°è¦ä½œæˆãƒ»ç·¨é›†ï¼‰
       ======================================== -->

  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
  <%= render 'shared/actions/back_link',
             url: :back,
             custom_class: 'me-2' %>

  <!-- ç™»éŒ²/æ›´æ–°ãƒœã‚¿ãƒ³ -->
  <% if params[:action] == 'new' || params[:action] == 'create' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.create') %>
    <% end %>
  <% elsif params[:action] == 'edit' || params[:action] == 'update' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.update') %>
    <% end %>
  <% end %>

   <script>
  document.addEventListener('DOMContentLoaded', function() {
    const headerBtn = document.getElementById('header_register_button');
    if (headerBtn) {
      headerBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('ğŸ”„ Header button clicked');
        console.log('Current action:', '<%= params[:action] %>');

        // ã¾ãšãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¢ã™
        const planForm = document.getElementById('plan_form');
        console.log('Form found:', planForm);

        if (planForm) {
          // submitãƒœã‚¿ãƒ³ã‚’æ¢ã™ï¼ˆè¤‡æ•°ã®æ–¹æ³•ã§è©¦ã™ï¼‰
          let submitBtn = document.getElementById('plan_submit_button');

          if (!submitBtn) {
            // IDã§è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ å†…ã®å…¨submitãƒœã‚¿ãƒ³ã‚’æ¢ã™
            submitBtn = planForm.querySelector('input[type=submit]');
            console.log('Submit button found in form:', submitBtn);
          }

          if (submitBtn) {
            console.log('âœ… Clicking submit button:', submitBtn.id || 'no-id');
            submitBtn.click();
          } else {
            // submitãƒœã‚¿ãƒ³ãŒãªã‘ã‚Œã°ç›´æ¥ãƒ•ã‚©ãƒ¼ãƒ ã‚’submit
            console.log('âš ï¸ No submit button, using form.requestSubmit()');
            try {
              planForm.requestSubmit();
            } catch (error) {
              console.error('requestSubmit failed, using form.submit():', error);
              planForm.submit();
            }
          }
        } else {
          console.error('âŒ Form not found');
        }
      });
    } else {
      console.warn('âš ï¸ Header register button not found');
    }
  });
  </script>