<% if is_form_page %>
  <!-- ========================================
       ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ï¼ˆæ–°è¦ä½œæˆãƒ»ç·¨é›†ï¼‰
       ======================================== -->

  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
  <%= render 'shared/actions/back_link',
             url: :back,
             custom_class: 'me-2' %>

  <!-- ç™»éŒ²/æ›´æ–°ãƒœã‚¿ãƒ³ -->
  <% if params[:action] == 'new' || params[:action] == 'create' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.create') %>
    <% end %>
  <% elsif params[:action] == 'edit' || params[:action] == 'update' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.update') %>
    <% end %>
  <% end %>

  <script>
  // Turboå¯¾å¿œ: DOMContentLoadedã¨turbo:loadã®ä¸¡æ–¹ã«å¯¾å¿œ
  function initializeHeaderButton() {
    const headerBtn = document.getElementById('header_register_button');

    if (!headerBtn) {
      console.warn('âš ï¸ Header register button not found');
      return;
    }

    // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ï¼ˆé‡è¤‡ç™»éŒ²é˜²æ­¢ï¼‰
    const newHeaderBtn = headerBtn.cloneNode(true);
    headerBtn.parentNode.replaceChild(newHeaderBtn, headerBtn);

    newHeaderBtn.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('ğŸ”„ Header button clicked');
      console.log('Current action:', '<%= params[:action] %>');

      // è¤‡æ•°ã®ãƒ•ã‚©ãƒ¼ãƒ IDã‚’è©¦ã™
      const form = document.getElementById('plan_form') ||
                   document.getElementById('product_form') ||
                   document.querySelector('form');

      console.log('Form found:', form);

      if (form) {
        // submitãƒœã‚¿ãƒ³ã‚’æ¢ã™ï¼ˆè¤‡æ•°ã®IDã‚’è©¦ã™ï¼‰
        let submitBtn = document.getElementById('plan_submit_button') ||
                       document.getElementById('product_submit_button') ||
                       form.querySelector('input[type=submit]');

        console.log('Submit button found:', submitBtn);

        if (submitBtn) {
          console.log('âœ… Clicking submit button');
          submitBtn.click();
        } else {
          console.log('âš ï¸ No submit button, using form.requestSubmit()');
          try {
            if (typeof form.requestSubmit === 'function') {
              form.requestSubmit();
            } else {
              console.log('âš ï¸ requestSubmit not supported, using form.submit()');
              form.submit();
            }
          } catch (error) {
            console.error('requestSubmit failed, using form.submit():', error);
            form.submit();
          }
        }
      } else {
        console.error('âŒ Form not found');
      }
    });

    console.log('âœ… Header button initialized');
  }

  // DOMContentLoadedï¼ˆTurboç„¡åŠ¹æ™‚ï¼‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeHeaderButton);
  } else {
    initializeHeaderButton();
  }

  // turbo:loadï¼ˆTurboæœ‰åŠ¹æ™‚ã®ãƒšãƒ¼ã‚¸é·ç§»ï¼‰
  document.addEventListener('turbo:load', initializeHeaderButton);
  </script>

<% elsif is_show_page %>
  <!-- ========================================
       è©³ç´°ç”»é¢
       ======================================== -->

  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆä¸€è¦§ã«æˆ»ã‚‹ï¼‰ -->
  <%
    # ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ä¸€è¦§ç”»é¢ã®ãƒ‘ã‚¹ã‚’å‹•çš„ã«ç”Ÿæˆ
    index_path = polymorphic_path(resource.class)
  %>
  <%= render 'shared/actions/back_link',
             url: index_path,
             custom_class: 'me-2' %>

  <!-- ç·¨é›†ãƒœã‚¿ãƒ³ -->
  <%= render 'shared/actions/edit_link',
             url: edit_polymorphic_path(resource),
             custom_class: 'me-2' %>

  <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
  <%= render 'shared/actions/delete_link',
             url: polymorphic_path(resource),
             resource_name: resource.class.model_name.human %>

<% elsif is_index_page %>
  <!-- ========================================
       ä¸€è¦§ç”»é¢
       ======================================== -->

  <!-- æ–°è¦ä½œæˆãƒœã‚¿ãƒ³ -->
  <% if new_path.present? %>
    <%= render 'shared/actions/new_link',
               url: new_path,
               custom_class: 'btn-sm' %>
  <% else %>
    <!-- new_pathãŒæ¸¡ã•ã‚Œã¦ã„ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
    <%
      # resourceã‹ã‚‰ãƒ‘ã‚¹ã‚’æ¨æ¸¬
      if defined?(resource) && resource
        resource_name = resource.class.model_name.singular_route_key.to_sym
        fallback_new_path = polymorphic_path([:new, resource_name])
      else
        fallback_new_path = '#'
      end
    %>
    <%= render 'shared/actions/new_link',
               url: fallback_new_path,
               custom_class: 'btn-sm' %>
  <% end %>

<% end %>