<% if is_form_page %>
  <!-- ========================================
       フォーム画面（新規作成・編集）
       ======================================== -->

  <!-- 戻るボタン -->
  <%= render 'shared/actions/back_link',
             url: :back,
             custom_class: 'me-2' %>

  <!-- 登録/更新ボタン -->
  <% if params[:action] == 'new' || params[:action] == 'create' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.create') %>
    <% end %>
  <% elsif params[:action] == 'edit' || params[:action] == 'update' %>
    <%= button_tag type: 'button',
                   class: 'btn btn-sm btn-primary',
                   id: 'header_register_button' do %>
      <i class="bi bi-check-circle me-1"></i>
      <%= t('helpers.submit.update') %>
    <% end %>
  <% end %>

   <script>
  document.addEventListener('DOMContentLoaded', function() {
    const headerBtn = document.getElementById('header_register_button');
    if (headerBtn) {
      headerBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('🔄 Header button clicked');
        console.log('Current action:', '<%= params[:action] %>');

        // まずフォームを探す
        const planForm = document.getElementById('plan_form');
        console.log('Form found:', planForm);

        if (planForm) {
          // submitボタンを探す（複数の方法で試す）
          let submitBtn = document.getElementById('plan_submit_button');

          if (!submitBtn) {
            // IDで見つからなければフォーム内の全submitボタンを探す
            submitBtn = planForm.querySelector('input[type=submit]');
            console.log('Submit button found in form:', submitBtn);
          }

          if (submitBtn) {
            console.log('✅ Clicking submit button:', submitBtn.id || 'no-id');
            submitBtn.click();
          } else {
            // submitボタンがなければ直接フォームをsubmit
            console.log('⚠️ No submit button, using form.requestSubmit()');
            try {
              planForm.requestSubmit();
            } catch (error) {
              console.error('requestSubmit failed, using form.submit():', error);
              planForm.submit();
            }
          }
        } else {
          console.error('❌ Form not found');
        }
      });
    } else {
      console.warn('⚠️ Header register button not found');
    }
  });
  </script>