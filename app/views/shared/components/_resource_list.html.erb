<%# 必須引数: title, resources, columns, resource_class :search_target, :resource_class %>
<%# オプション引数: new_path, icon_mode %>
<% search_target = local_assigns[:search_target] %>
<% resource_class = local_assigns[:resource_class] %>
<% search_categories = local_assigns[:search_categories] %>
<% show_copy = local_assigns.fetch(:show_copy, false) %>
<% copy_url_method = local_assigns[:copy_url_method] %>
<% show_print = local_assigns.fetch(:show_print, false) %>
<% print_url_method = local_assigns[:print_url_method] %>
<% icon_mode = local_assigns.fetch(:icon_mode, false) %>

<%# 2.検索フォーム %>
<% if search_target.present? %>
  <%= render 'shared/forms/search_form',
      form_path: send(resource_class.model_name.route_key + '_path'),
      search_target: search_target,
      search_categories: search_categories %>
<% end %>

<%# 3. テーブル全体の描画 %>
<table class="table mt-4">
  <thead class="table-light">
    <tr>
      <% columns.each do |col| %>
    <th>
      <% if col[:header].present? %>
        <%= resource_class.human_attribute_name(col[:header]) %>
      <% end %>
    </th>
  <% end %>
  <th><%= t('common.action') %></th>
</tr>
  </thead>
  <tbody>
    <% resources.each do |resource| %>
      <tr data-id="<%= resource.id %>">
        <% columns.each do |col| %>
          <td>
            <%= render_resource_data(resource, col) %>
          </td>
        <% end %>

        <%# アクションカラム %>
        <td>
          <%= render 'shared/actions/resource_action_links',
              resource: resource,
              resource_name: resource.class.model_name.human,
              show_link: defined?(show_action_link) ? show_action_link : true,
              show_copy: show_copy,
              copy_url: show_copy && copy_url_method.present? ?
              send(copy_url_method, resource) : nil,
              icon_mode: icon_mode
          %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
