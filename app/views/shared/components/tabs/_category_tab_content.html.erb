<%# カテゴリタブコンテンツ %>
<%
  category_id = local_assigns[:category_id].to_i
  items = local_assigns[:items]
  form_builder = local_assigns[:form_builder] || local_assigns[:f]
  association_name = local_assigns[:association_name]
  item_partial = local_assigns[:item_partial]
  table_headers = local_assigns[:table_headers]
  add_button_text = local_assigns[:add_button_text]
  show_category_total = local_assigns.fetch(:show_category_total, false)
  total_target = local_assigns[:total_target]
%>

<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <%= table_headers.html_safe %>
    </thead>
    <tbody data-form--nested-form-target="target" data-category-id="<%= category_id %>">
      <% items.each do |item| %>
        <%= form_builder.fields_for association_name, item do |ff| %>
          <%= render item_partial, f: ff, category_id: category_id %>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <% if category_id != 0 %>
    <div class="mt-3">
      <button type="button"
              class="btn btn-outline-success w-100"
              data-category-id="<%= category_id %>"
              data-template-id="<%= item_partial.gsub('_fields', '') %>_fields_template_<%= category_id %>"
              data-action="click->form--nested-form#add">
        <%= add_button_text %>
      </button>
    </div>

    <% if show_category_total && total_target.present? %>
      <div class="text-end mt-3 fw-bold">
        <%= t('totals.category') %>:
        <span data-resources--plan-product--totals-target="categoryTotal" data-category-id="<%= category_id %>">¥0</span>
      </div>
    <% end %>
  <% end %>
</div>
